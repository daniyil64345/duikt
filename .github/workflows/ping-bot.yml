name: ü§ñ Keep Bot Alive

on:
  schedule:
    # –ó–∞–ø—É—Å–∫ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    - cron: '*/5 * * * *'
  
  workflow_dispatch: # –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –≤—Ä—É—á–Ω—É —á–µ—Ä–µ–∑ UI
  
  push:
    branches: [ main ]  # –¢–µ—Å—Ç–æ–≤–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ push

jobs:
  ping-bot:
    runs-on: ubuntu-latest
    
    steps:
      - name: üîç Ping Replit Bot
        id: ping
        run: |
          echo "üîÑ –ü–æ—á–∞—Ç–æ–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –±–æ—Ç–∞..."
          echo "‚è∞ –ß–∞—Å: $(date)"
          echo "üåê URL: ${{ secrets.REPLIT_URL }}"
          
          # –ü—ñ–Ω–≥ –∑ timeout 30 —Å–µ–∫—É–Ω–¥
          HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" --max-time 30 "${{ secrets.REPLIT_URL }}/health" || echo "000")
          
          echo "üìä HTTP —Å—Ç–∞—Ç—É—Å: $HTTP_CODE"
          
          if [ "$HTTP_CODE" = "200" ]; then
            echo "‚úÖ –ë–æ—Ç –ø—Ä–∞—Ü—é—î –Ω–æ—Ä–º–∞–ª—å–Ω–æ!"
            echo "status=success" >> $GITHUB_OUTPUT
          else
            echo "‚ùå –ë–æ—Ç –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î! –ö–æ–¥: $HTTP_CODE"
            echo "status=failed" >> $GITHUB_OUTPUT
            echo "http_code=$HTTP_CODE" >> $GITHUB_OUTPUT
          fi
      
      - name: üì± –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ Telegram —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è (—è–∫—â–æ –ø–æ–º–∏–ª–∫–∞)
        if: steps.ping.outputs.status == 'failed'
        run: |
          MESSAGE="üî¥ –£–í–ê–ì–ê! –ë–æ—Ç –º–∞–≥–∞–∑–∏–Ω—É –Ω–µ –ø—Ä–∞—Ü—é—î!%0A%0A"
          MESSAGE="${MESSAGE}üìä HTTP —Å—Ç–∞—Ç—É—Å: ${{ steps.ping.outputs.http_code }}%0A"
          MESSAGE="${MESSAGE}‚è∞ –ß–∞—Å: $(date +'%Y-%m-%d %H:%M:%S')%0A"
          MESSAGE="${MESSAGE}üîó URL: ${{ secrets.REPLIT_URL }}%0A%0A"
          MESSAGE="${MESSAGE}üëâ –í—ñ–¥–∫—Ä–∏–π—Ç–µ Replit —ñ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –±–æ—Ç–∞!"
          
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d "chat_id=${{ secrets.TELEGRAM_CHAT_ID }}" \
            -d "text=$MESSAGE" \
            -d "parse_mode=HTML"
      
      - name: ‚è≥ –ü–æ–≤—Ç–æ—Ä–Ω–∞ —Å–ø—Ä–æ–±–∞ —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥ (—è–∫—â–æ –ø–æ–º–∏–ª–∫–∞)
        if: steps.ping.outputs.status == 'failed'
        run: |
          echo "‚è≥ –ß–µ–∫–∞—î–º–æ 30 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ—é —Å–ø—Ä–æ–±–æ—é..."
          sleep 30
          
          HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" --max-time 30 "${{ secrets.REPLIT_URL }}/health" || echo "000")
          
          if [ "$HTTP_CODE" = "200" ]; then
            echo "‚úÖ –ë–æ—Ç –≤—ñ–¥–Ω–æ–≤–∏–≤—Å—è –ø—ñ—Å–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó —Å–ø—Ä–æ–±–∏!"
            
            curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
              -d "chat_id=${{ secrets.TELEGRAM_CHAT_ID }}" \
              -d "text=‚úÖ –ë–æ—Ç –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ! –ü—Ä–∞—Ü—é—î –Ω–æ—Ä–º–∞–ª—å–Ω–æ." \
              -d "parse_mode=HTML"
          else
            echo "‚ùå –ë–æ—Ç –≤—Å–µ —â–µ –Ω–µ –ø—Ä–∞—Ü—é—î. –ö–æ–¥: $HTTP_CODE"
            exit 1
          fi
```